<!DOCTYPE html>

<html>
<head>
  <title>sample.lua</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>sample.lua</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span><span class="hljs-string">&quot;about&quot;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <h2 id="some">Some</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <p>Reservoir sampler (of size of <code>max</code>). </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> Some=klass<span class="hljs-string">&quot;Some&quot;</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Some:new</span><span class="hljs-params">(max)</span></span> 
  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;newsome&quot;</span>,<span class="hljs-built_in">max</span>)
  <span class="hljs-keyword">return</span> isa(Some,{n=<span class="hljs-number">0</span>, <span class="hljs-built_in">max</span>=<span class="hljs-built_in">max</span> <span class="hljs-keyword">or</span> <span class="hljs-number">256</span>, old=<span class="hljs-literal">true</span>, _has={}}) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <p>Add to a reservoir sampling. If full, replace anything at random.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Some:add</span><span class="hljs-params">(x)</span></span> 
  <span class="hljs-keyword">if</span> #<span class="hljs-built_in">self</span>._has &lt; <span class="hljs-built_in">self</span>.<span class="hljs-built_in">max</span> <span class="hljs-keyword">then</span> pos = <span class="hljs-number">1</span>+#<span class="hljs-built_in">self</span>._has 
  <span class="hljs-keyword">elseif</span> rand() &lt; <span class="hljs-built_in">self</span>.<span class="hljs-built_in">max</span>/<span class="hljs-built_in">self</span>.n <span class="hljs-keyword">then</span> pos = <span class="hljs-number">1</span>+(rand()*#<span class="hljs-built_in">self</span>._has)//<span class="hljs-number">1</span> <span class="hljs-keyword">end</span> 
  <span class="hljs-keyword">if</span> pos <span class="hljs-keyword">then</span> 
    <span class="hljs-built_in">self</span>.old=<span class="hljs-literal">true</span>
    <span class="hljs-built_in">self</span>._has[pos]=x <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p>Return the contents, sorted.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Some:has</span><span class="hljs-params">()</span></span>  
  <span class="hljs-keyword">if</span> <span class="hljs-built_in">self</span>.old <span class="hljs-keyword">then</span> <span class="hljs-built_in">table</span>.<span class="hljs-built_in">sort</span>(<span class="hljs-built_in">self</span>._has) <span class="hljs-keyword">end</span>
  <span class="hljs-built_in">self</span>.old = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span>._has <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p>Report the <code>p-th</code> value within the sorted contents.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Some:per</span><span class="hljs-params">(p)</span></span> a= <span class="hljs-built_in">self</span>:has(i); <span class="hljs-keyword">return</span> a[ ((p <span class="hljs-keyword">or</span> <span class="hljs-number">.5</span>)*#a) // <span class="hljs-number">1</span> ] <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <h2 id="col">Col</h2>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p>Abstract class for columns.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> Col=klass<span class="hljs-string">&quot;Col&quot;</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col:new</span><span class="hljs-params">(at,name)</span></span> <span class="hljs-keyword">return</span> isa(Col,{at=at <span class="hljs-keyword">or</span> <span class="hljs-number">1</span>,name=name <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>,n=<span class="hljs-number">0</span>}) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <p>“Adding” means do nothing so the  central ten dances and spreads never change.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col:add</span><span class="hljs-params">(x)</span></span> <span class="hljs-keyword">return</span> x <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col:mid</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;?&quot;</span> <span class="hljs-keyword">end</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Col:spread</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <h2 id="sym">Sym</h2>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <p>Counter for symbols.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> Sym=klass<span class="hljs-string">&quot;Sym&quot;</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sym:new</span><span class="hljs-params">(at, name)</span></span>  
  <span class="hljs-keyword">return</span> isa(Sym, Col:new(at,name), {has={}, mode=<span class="hljs-string">&quot;&quot;</span>, most=<span class="hljs-number">0</span>}) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <p>Adding means updating symbol count (and the <code>mode</code>).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sym:add</span><span class="hljs-params">(x)</span></span> 
  <span class="hljs-keyword">if</span> x ~= <span class="hljs-string">&quot;?&quot;</span> <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">self</span>.n = <span class="hljs-built_in">self</span>.n+<span class="hljs-number">1</span>
    <span class="hljs-built_in">self</span>.has[x] = <span class="hljs-number">1</span> + (<span class="hljs-built_in">self</span>.has[x] <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
    <span class="hljs-keyword">if</span>   <span class="hljs-built_in">self</span>.has[x] &gt; <span class="hljs-built_in">self</span>.most 
    <span class="hljs-keyword">then</span> <span class="hljs-built_in">self</span>.most,<span class="hljs-built_in">self</span>.mode = <span class="hljs-built_in">self</span>.has[x],x <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>  <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <p><code>mid</code> means <code>mode</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sym:mid</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span>.mode <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <p><code>Spread</code> means entropy.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sym:spread</span><span class="hljs-params">(    e)</span></span>
  e=<span class="hljs-number">0</span>
  <span class="hljs-keyword">for</span> _,v <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(<span class="hljs-built_in">self</span>.has) <span class="hljs-keyword">do</span> e = e - v/<span class="hljs-built_in">self</span>.n * <span class="hljs-built_in">math</span>.<span class="hljs-built_in">log</span>(v/<span class="hljs-built_in">self</span>.n,<span class="hljs-number">2</span>) <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> e <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <h2 id="num">Num</h2>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <p>counter for numbers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> Num=klass<span class="hljs-string">&quot;Num&quot;</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Num:new</span><span class="hljs-params">(at,name)</span></span> 
  <span class="hljs-keyword">return</span> isa(Num, Col:new(at,name), 
             {some=Some.new(), lo=<span class="hljs-number">1E32</span>, hi=<span class="hljs-number">-1E32</span>,
              w = i.name:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;+&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> i.name:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;-&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-number">-1</span> <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>}) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <p>Keep some numbers, update <code>lo</code>, <code>hi</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Num:add</span><span class="hljs-params">(x)</span></span>
  <span class="hljs-keyword">if</span> x ~= <span class="hljs-string">&quot;?&quot;</span> <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">self</span>.n = <span class="hljs-built_in">self</span>.n + <span class="hljs-number">1</span>
    <span class="hljs-built_in">self</span>.some:add(x)
    <span class="hljs-keyword">if</span> x &gt; <span class="hljs-built_in">self</span>.hi <span class="hljs-keyword">then</span> <span class="hljs-built_in">self</span>.hi = x <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">if</span> x &lt; <span class="hljs-built_in">self</span>.lo <span class="hljs-keyword">then</span> <span class="hljs-built_in">self</span>.lo = x <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <p>Central tendency.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Num:mid</span><span class="hljs-params">(i)</span></span> <span class="hljs-keyword">return</span>  <span class="hljs-built_in">self</span>.some:per(<span class="hljs-number">.5</span>) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <p>Spread around the central  tenancy means standard deviation
(Aside: we all know that +- 1,2 standard deviations is 66,95% of the mass.
Well, what else is true is that +- 1.28 standard deviations 
is 90% of the pass. To say that another way, (90-10)th/(1.28*2)
is one standard deviation.)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Num:spread</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">return</span> (<span class="hljs-built_in">self</span>.some:per(<span class="hljs-number">.9</span>) - <span class="hljs-built_in">self</span>.some:per(<span class="hljs-number">.1</span>))/<span class="hljs-number">2.54</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <p>Normalize</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Num:norm</span><span class="hljs-params">(x)</span></span> 
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">math</span>.<span class="hljs-built_in">abs</span>(x-y)&lt;<span class="hljs-number">1E-32</span> <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> (x - <span class="hljs-built_in">self</span>.lo)/(<span class="hljs-built_in">self</span>.hi - <span class="hljs-built_in">self</span>.lo) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <h2 id="sample">Sample</h2>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-22">&#x00a7;</a>
              </div>
              <p>holder of rows and columns</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> Sample=klass<span class="hljs-string">&quot;Sample&quot;</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:new</span><span class="hljs-params">(the, inits,       i)</span></span>
  <span class="hljs-built_in">self</span> = isa(Sample, {the=the,rows={},keep=<span class="hljs-literal">true</span>,
                   klass=<span class="hljs-literal">nil</span>, cols={},names={},x={},y={}})
  <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(inits)==<span class="hljs-string">&quot;table&quot;</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">for</span> _,lst <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(inits) <span class="hljs-keyword">do</span> <span class="hljs-built_in">self</span>:row(lst) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(inits)==<span class="hljs-string">&quot;string&quot;</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">for</span> lst <span class="hljs-keyword">in</span> csv(inits) <span class="hljs-keyword">do</span> <span class="hljs-built_in">self</span>:row(lst) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-23">&#x00a7;</a>
              </div>
              <p>Report the mid of certain columns (defaults to “use all”)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:mid</span><span class="hljs-params">(cols)</span></span> 
  t={}; <span class="hljs-keyword">for</span> _,c <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(cols <span class="hljs-keyword">or</span> <span class="hljs-built_in">self</span>.cols) <span class="hljs-keyword">do</span> t[<span class="hljs-number">1</span>+#t]=c:mid() <span class="hljs-keyword">end</span>; <span class="hljs-keyword">return</span> t <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-24">&#x00a7;</a>
              </div>
              <p>Report the spread of certain columns (defaults to “use all”)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:spread</span><span class="hljs-params">(cols)</span></span> 
  t={}; <span class="hljs-keyword">for</span> _,c <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(cols <span class="hljs-keyword">or</span> <span class="hljs-built_in">self</span>.cols) <span class="hljs-keyword">do</span> t[<span class="hljs-number">1</span>+#t]=c:spread() <span class="hljs-keyword">end</span>; <span class="hljs-keyword">return</span> t <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-25">&#x00a7;</a>
              </div>
              <p>Add new row. If this is the first row, the use the row to create columns.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:add</span><span class="hljs-params">(t)</span></span> 
  <span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">names2Column</span><span class="hljs-params">(      what,new,tmp)</span></span>
    <span class="hljs-built_in">self</span>.names = t
    <span class="hljs-keyword">for</span> at,name <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(t)  <span class="hljs-keyword">do</span>
      what = name:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;:&quot;</span> <span class="hljs-keyword">and</span> Col <span class="hljs-keyword">or</span> name:<span class="hljs-built_in">match</span><span class="hljs-string">&quot;^[A-Z]&quot;</span> <span class="hljs-keyword">and</span> Num <span class="hljs-keyword">or</span> Sym
      new  = what.new(at,name) 
      <span class="hljs-built_in">self</span>.cols[<span class="hljs-number">1</span>+#<span class="hljs-built_in">self</span>.cols] = new
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> name:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;:&quot;</span> <span class="hljs-keyword">then</span>
        xy= (name:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;+&quot;</span> <span class="hljs-keyword">or</span> name:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;-&quot;</span> <span class="hljs-keyword">or</span> name:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;!&quot;</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">self</span>.y <span class="hljs-keyword">or</span> <span class="hljs-built_in">self</span>.x
        <span class="hljs-built_in">print</span>(name, #xy, name:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;+&quot;</span> <span class="hljs-keyword">or</span> name:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;-&quot;</span> <span class="hljs-keyword">or</span> name:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;!&quot;</span>)
        xy[ <span class="hljs-number">1</span>+#xy ] = new
        <span class="hljs-keyword">if</span> name:<span class="hljs-built_in">find</span><span class="hljs-string">&quot;!&quot;</span> <span class="hljs-keyword">then</span> <span class="hljs-built_in">self</span>.klass = new <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> 
   <span class="hljs-keyword">end</span> <span class="hljs-comment">-----------------</span>
   <span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">row</span><span class="hljs-params">()</span></span>
     <span class="hljs-keyword">if</span> <span class="hljs-built_in">self</span>.keep <span class="hljs-keyword">then</span> <span class="hljs-built_in">self</span>.rows[ <span class="hljs-number">1</span>+#<span class="hljs-built_in">self</span>.rows ] = t <span class="hljs-keyword">end</span>
     <span class="hljs-keyword">for</span> _,col <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(<span class="hljs-built_in">self</span>.cols) <span class="hljs-keyword">do</span> add(col, t[col.at]) <span class="hljs-keyword">end</span> 
   <span class="hljs-keyword">end</span> <span class="hljs-comment">-------------------------------------------</span>
   <span class="hljs-keyword">if</span> #<span class="hljs-built_in">self</span>.names&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">then</span> row() <span class="hljs-keyword">else</span> names2Column() <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-26">&#x00a7;</a>
              </div>
              <p>Return a new sampler with same structure as <code>i</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:clone</span><span class="hljs-params">(inits,     i)</span></span>
   <span class="hljs-built_in">self</span> = Sample:new(<span class="hljs-built_in">self</span>.the)
   add(<span class="hljs-built_in">self</span>, <span class="hljs-built_in">self</span>.names)
   <span class="hljs-keyword">for</span> _,row <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(inits <span class="hljs-keyword">or</span> {}) <span class="hljs-keyword">do</span> add(<span class="hljs-built_in">self</span>, row) <span class="hljs-keyword">end</span>
   <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-27">&#x00a7;</a>
              </div>
              <p>Return the klass variable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sample:klass</span><span class="hljs-params">(row)</span></span> <span class="hljs-keyword">return</span> row[<span class="hljs-built_in">self</span>.klass.at] <span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> {Some=Some, Num=Num, Sym=Sym, Col=Col, Sample=Sample}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
