<!DOCTYPE html>

<html>
<head>
  <title>Misc lib stuff</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <h1 id="misc-lib-stuff">Misc lib stuff</h1>
<p>(c)2021, Tim Menzies <a href="mailto:&#x74;&#105;&#109;&#x6d;&#x40;&#105;&#x65;&#x65;&#101;&#46;&#111;&#x72;&#x67;">&#x74;&#105;&#109;&#x6d;&#x40;&#105;&#x65;&#x65;&#101;&#46;&#111;&#x72;&#x67;</a>, unlicense.org<br><a href="index">home</a> :: <a href="discuss">discuss</a> ::  <a href="tests">tests</a>  </p>
<hr>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <h2 id="string-stuff">String Stuff</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <p>Formatting strings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fmt</span><span class="hljs-params">(...)</span></span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.<span class="hljs-built_in">format</span>(...) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p><strong>showr(t:tbl) :str</strong><br>Return table as string. Print table in sorted keys
order. For simple arrays (with contiguous numeric keys). donâ€™t
show the keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span><span class="hljs-params">(t,     u,mt,pre,ks)</span></span>
  u,ks = {},{}
  <span class="hljs-keyword">for</span> k,_ <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(t) <span class="hljs-keyword">do</span> <span class="hljs-keyword">if</span> k:<span class="hljs-built_in">sub</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)~=<span class="hljs-string">&quot;_&quot;</span> <span class="hljs-keyword">then</span> ks[<span class="hljs-number">1</span>+#ks]=k <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span>
  <span class="hljs-built_in">table</span>.<span class="hljs-built_in">sort</span>(ks)
  <span class="hljs-keyword">for</span> _,k <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(ks) <span class="hljs-keyword">do</span> 
    s= <span class="hljs-built_in">tostring</span>(t[k])
    u[<span class="hljs-number">1</span>+#u]= #t&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">and</span> s <span class="hljs-keyword">or</span> k..<span class="hljs-string">&quot;=&quot;</span>..s <span class="hljs-keyword">end</span> 
  pre = (<span class="hljs-built_in">getmetatable</span>(t) <span class="hljs-keyword">or</span> {})._name <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>
  <span class="hljs-keyword">return</span> pre.. <span class="hljs-string">&quot;(&quot;</span>..<span class="hljs-built_in">table</span>.<span class="hljs-built_in">concat</span>(u,<span class="hljs-string">&quot;, &quot;</span>)..<span class="hljs-string">&quot;)&quot;</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <h2 id="oo-stuff">OO Stuff</h2>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p><strong>klass(name:str):tbl</strong><br>Create a constructor <code>klass()</code> (and store a print <code>name</code>).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">klass</span><span class="hljs-params">(s,up,   k)</span></span> 
  k= <span class="hljs-built_in">setmetatable</span>({_name=is, <span class="hljs-built_in">__tostring</span>=show}, up) 
  k.<span class="hljs-built_in">__index</span> = k
  <span class="hljs-keyword">return</span> k <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p><strong>isa(klass:tbl, ?new:tbl, ?also:tbl):tbl</strong><br>Delegate calls to <code>new</code> to <code>klass</code>. If <code>also</code> exists, add those slots.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isa</span><span class="hljs-params">(self,    new,also, super)</span></span>
  new = <span class="hljs-built_in">setmetatable</span>(new <span class="hljs-keyword">or</span> {},<span class="hljs-built_in">self</span>)
  <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(also <span class="hljs-keyword">or</span> {}) <span class="hljs-keyword">do</span> new[k]=v <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> new <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <p><strong>Obj:new():Obt</strong>  </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> Obj=klass(<span class="hljs-string">&quot;Obj&quot;</span>)
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Obj:new</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">return</span> isa(Obj) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <h2 id="list-stuff">List stuff</h2>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <p>Sorting lists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">order</span><span class="hljs-params">(t)</span></span> <span class="hljs-built_in">table</span>.<span class="hljs-built_in">sort</span>(t); <span class="hljs-keyword">return</span> t  <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <p>First few items ina  list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">top</span><span class="hljs-params">(t,n,     u)</span></span>
  u={}; <span class="hljs-keyword">for</span> i=<span class="hljs-number">1</span>,n <span class="hljs-keyword">do</span> u[i]=t[i] <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> u <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <p>Randomizing order or list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shuffle</span><span class="hljs-params">(t,the,     j)</span></span>
  <span class="hljs-keyword">for</span> i = #t, <span class="hljs-number">2</span>, <span class="hljs-number">-1</span> <span class="hljs-keyword">do</span>
    j = the.rand:int(<span class="hljs-number">1</span>,i)
    t[i], t[j] = t[j], t[i] <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">return</span> t <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <h2 id="file-stuff">File Stuff</h2>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <p>Reading csv files (each line read as one table)/</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">csv</span><span class="hljs-params">(file,      split,stream,tmp)</span></span>
  stream = file <span class="hljs-keyword">and</span> <span class="hljs-built_in">io</span>.<span class="hljs-built_in">input</span>(file) <span class="hljs-keyword">or</span> <span class="hljs-built_in">io</span>.<span class="hljs-built_in">input</span>()
  tmp    = <span class="hljs-built_in">io</span>.<span class="hljs-built_in">read</span>()
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(       t)</span></span>
    <span class="hljs-keyword">if</span> tmp <span class="hljs-keyword">then</span>
      t,tmp = {},tmp:<span class="hljs-built_in">gsub</span>(<span class="hljs-string">&quot;[\t\r ]*&quot;</span>,<span class="hljs-string">&quot;&quot;</span>):<span class="hljs-built_in">gsub</span>(<span class="hljs-string">&quot;#.*&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)
      <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">string</span>.<span class="hljs-built_in">gmatch</span>(tmp, <span class="hljs-string">&quot;([^,]+)&quot;</span>) <span class="hljs-keyword">do</span> t[#t+<span class="hljs-number">1</span>]=y <span class="hljs-keyword">end</span>
      tmp = <span class="hljs-built_in">io</span>.<span class="hljs-built_in">read</span>()
      <span class="hljs-keyword">if</span>  #t &gt; <span class="hljs-number">0</span> 
      <span class="hljs-keyword">then</span> <span class="hljs-keyword">for</span> j,x <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(t) <span class="hljs-keyword">do</span> t[j] = <span class="hljs-built_in">tonumber</span>(x) <span class="hljs-keyword">or</span> x <span class="hljs-keyword">end</span>
           <span class="hljs-keyword">return</span> t <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">else</span> <span class="hljs-built_in">io</span>.<span class="hljs-built_in">close</span>(stream) <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <h2 id="random-stuff">Random Stuff</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">local</span> Rand={}</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <p>Random seeds.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rand:new</span><span class="hljs-params">(seed)</span></span>   <span class="hljs-keyword">return</span> obj(rand,{seed=seed <span class="hljs-keyword">or</span> <span class="hljs-number">10014</span>})  <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <p>Random integers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rand:int</span><span class="hljs-params">(lo,hi)</span></span>; <span class="hljs-keyword">return</span> <span class="hljs-built_in">math</span>.<span class="hljs-built_in">floor</span>(<span class="hljs-number">0.5</span> + <span class="hljs-built_in">self</span>:<span class="hljs-built_in">next</span>(lo,hi)) <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <p>Random floats</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rand:next</span><span class="hljs-params">(lo,hi)</span></span> 
  lo, hi = lo <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>, hi <span class="hljs-keyword">or</span> <span class="hljs-number">1</span>
  <span class="hljs-built_in">self</span>.seed = (<span class="hljs-number">16807</span> * <span class="hljs-built_in">self</span>.seed) % <span class="hljs-number">2147483647</span> 
  <span class="hljs-keyword">return</span> lo + (hi-lo) * <span class="hljs-built_in">self</span>.seed / <span class="hljs-number">2147483647</span> <span class="hljs-keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <hr>

            </div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <p>Returns:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">return</span> {show=show, klass=klass, isa=isa, order=order,
        top=top, shuffle=shuffle, Rand=Rand}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
